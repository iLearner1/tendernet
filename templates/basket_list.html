{% extends "base.html" %}
{% block content %}

<!-- Breadcrumb -->
<div class="breadcrumb-top alice-bg padding-top-30 padding-bottom-30">
  <div class="container">
    <div class="row">
      <div class="col-md-6">
        <div class="breadcrumb-area">
          <h1>Мои заявки</h1>
          <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
              <li class="breadcrumb-item"><a href="{% url 'index' %}">Главная</a></li>
              <li class="breadcrumb-item active" aria-current="page">Мои заявки</li>
            </ol>
          </nav>
        </div>
      </div>
    </div>
  </div>
</div>
<!-- Breadcrumb End -->

<div class="alice-bg section-padding-bottom tender-details-page">
  <div class="container">
    <div class="row">
      <div class="col">
        <div class="tender-details moi-cabinet">
          <div class="title-and-info">
            <div class="title">
              <div class="title-body">
                <h4>ID: {{ user.username }} </h4>
                <div class="info">
                  <span class="candidate-designation"><i class="fas fa-file"></i>&nbsp;Тариф "{{ user.profile.tarif }} "</span>
                </div>
              </div>
            </div>

          </div>

          <hr>
        
          <div class="details-information section-padding-20">
            <div class="row">
              <div class="col-xl-8 col-lg-8">
                <div class="card-deck mb-12 edication-background details-section">
                    <div class="card mb-12 box-shadow border-0">
                        <div class="card-header">
                            <div class="edication-background details-section" style="background-color: #fff; padding: 0;">
                              <h4><i data-feather="book"></i>Мои заявки</h4>
                            </div>
                        </div>

                        <div class="card-body d-flex flex-column" id="basket-list">

                          {% for p in basket_posts %}
                              <div class="application-wrapper">
                                <div class="application flex-column flex-md-row flex-lg-row flex-xl-row align-items-center">
                                  <div class="headding-info mb-3 mb-xl-0 mb-md-0 mb-lg-0">
                                    <h6>Подача заявки на лот</h6>
                                    <p>Дата подачи {{ p.date }}</p>
                                  </div>
                                  <a href="{{ p.lot.get_absolute_url }}" target="_blank" class="basket-title">
                                    <h6 class="name  mb-3 mb-xl-0 mb-md-0 mb-lg-0 mx-md-2 mx-lg-2 mx-xl-2">
                                      {{ p.lot.title }}
                                    </h6>
                                  </a>
                                  <div class="content">
                                    {% for item in p.preference %}
                                      <p>{{item.name}}: {{item.value}}</p>
                                    {% endfor %}
                                  </div>
                                </div>
                              </div>

                            {% empty %}
                              <p style="font-weight: bold;">
                                • Нет заявок
                              </p>
                          {% endfor %}
                         
                          {% if total_pages > 1 %}
                              <div class="pagination-list text-center text-md-right text-xl-right text-lg-right">
                                <nav class="navigation pagination">
                                  <div class="nav-links basket">
                                    {% if basket_posts.has_previous %}
                                      <a class="prev page-numbers" href="javascript:void(0);" data-page="1"> << </a>
                                      <a class="prev page-numbers" href="javascript:void(0);" data-page="{{ basket_posts.previous_page_number }}"> < </a>
                                    {% endif %}
                                    {% for p in basket_posts.paginator.page_range %}
                                        {% if basket_posts.number == p %}
                                            <a aria-current="page" href="javascript:void(0);"  data-page="{{ p }}" class="page-numbers current">{{ p }}</a>
                                        {% elif p > basket_posts.number|add:'-3' and p <= basket_posts.number|add:'3' %}
                                            <a aria-current="page" href="javascript:void(0);" data-page="{{ p }}" class="page-numbers">{{ p }}</a>
            
                                        {% endif %}
                                    {% endfor %}
                                    {% if basket_posts.has_next %}
                                      <a class="next page-numbers" href="javascript:void(0);" data-page="{{ basket_posts.next_page_number }}"> > </a>
                                      <a class="prev page-numbers" href="javascript:void(0);" data-page="{{ total_pages }}"> >> </a>
                                    {% endif %}
                                  </div>
                                </nav>
                              </div>
                          {% endif %}
                        </div>
                    </div>
                  </div>

              </div>
              <div class="col-xl-4 col-lg-4">

                <div class="information-and-share">
                  <div class="tender-summary">
                    <div class="buttons">
                      <a href="/profile" class="button contact-button" style="display: block;width: 100%;text-align: center;margin-right: 0;margin-bottom: 10px;">Личный кабинет</a>
                      <a href="{% url 'edit_tarif' %}" class="button contact-button" data-toggle="modal" data-target="#" style="display: none;width: 100%;text-align: center;margin-bottom: 10px;">Изменить тариф</a>
                      <a href="{% url 'post_favourite_list' %}" class="save" style="display: block;width: 100%;text-align: center;margin-right: 0!important;margin-bottom: 10px!important;"><i class="fa fa-star"></i>&nbsp;Избранные лоты</a>
                      <a href="{% url 'favorite_search_list' %}" class="save" style="display: block;width: 100%;text-align: center;margin-right: 0!important;margin-bottom: 10px!important;"><i class="fa fa-search"></i>&nbsp;Избранный поиск</a>
                    </div>
                  </div>
                </div>

              </div>
            </div>

          </div>

        </div>
      </div>
    </div>
  </div>
</div>

{% endblock %}

{% block jsscript%}

<script>
  $(document).on("click", ".nav-links.basket a", function(event) {
    event.preventDefault();
    var data = {};
    data["page"] = parseInt($(this).attr("data-page"));
    $.ajax({
          method: 'GET',
          url: "{% url 'basket_list' %}",
          data: data,
          success: function (resp) {
              $("#basket-list").html(resp);
          },
          error: function (err) {
            console.log(err.responseText);
          }
    });
  });
</script>
{% endblock jsscript %}